.\" Automatically generated by Pandoc 3.8
.\"
.TH "PAM_HIMMELBLAU" "8" "" "Himmelblau PAM module" "July 2025"
.SH NAME
\f[B]pam_himmelblau\f[R] \(em enable Azure Entra ID authentication via
Himmelblau
.SH SYNOPSIS
\f[B]pam_himmelblau.so\f[R] [debug] [use_first_pass]
[ignore_unknown_user] [mfa_poll_prompt] [no_hello_pin]
.SH DESCRIPTION
\f[B]pam_himmelblau\f[R] is a PAM module that authenticates users
against Microsoft Azure Entra ID using the Himmelblau daemon
(\f[CR]himmelblaud\f[R]).
.SH OPTIONS
.IP \(bu 2
\f[B]debug\f[R]
.PD 0
.P
.PD
Enables verbose logging to stdout.
.IP \(bu 2
\f[B]use_first_pass\f[R]
.PD 0
.P
.PD
Uses a password already provided by a previous PAM module as either a
Linux Hello PIN or an Entra Id password, instead of prompting again.
.IP \(bu 2
\f[B]ignore_unknown_user\f[R]
.PD 0
.P
.PD
Returns \f[CR]PAM_IGNORE\f[R] for users not in Entra ID, allowing
fallback to local authentication via subsequent PAM modules.
.IP \(bu 2
\f[B]mfa_poll_prompt\f[R]
.PD 0
.P
.PD
Workaround for OpenSSH Bug 2876, which prevents PAM messages from being
flushed to stdout until after sending a prompt for input.
This workaround causes pam to prompt the user to `press enter to
continue' when polling on another device for MFA.
.IP \(bu 2
\f[B]no_hello_pin\f[R]
.PD 0
.P
.PD
Disables Linux Hello PIN login for this service (e.g., for
\f[CR]sudo\f[R] or \f[CR]ssh\f[R]), even if Hello is configured
globally.
.SH PAM CONFIGURATION
Configuring PAM ensures authentication requests go through Entra ID when
appropriate.
.SS Automatic setup
On Ubuntu/Debian:
.IP
.EX
sudo pam\-auth\-update
.EE
.PP
Enable \(lqAzure authentication\(rq and verify PAM files.
.PP
On openSUSE Tumbleweed or SLE:
.IP
.EX
pam\-config \-\-add \-\-himmelblau
.EE
.PP
The \f[CR]aad\-tool configure\-pam\f[R] command also inserts recommended
directives (dry\-run unless \f[CR]\-\-really\f[R] is used).
.SS Manual configuration
In \f[CR]/etc/pam.d/common\-auth\f[R], ensure that the
\f[CR]pam_himmelblau.so\f[R] module is placed after other authentication
methods (such as \f[CR]pam_unix.so\f[R]).
Ensure that other authentication modules are not set to
\f[CR]required\f[R], as this could cause authentication to fail prior to
PAM communicating with Entra ID.
Include the \f[CR]ignore_unknown_user\f[R] option for Himmelblau.
Ensure \f[CR]pam_deny.so\f[R] is placed after all modules, so that
unknown users are not implicitly allowed.
.SS \f[B]Note:\f[R] If you intend to use Hello or Passwordless authentication, it\(cqs recommended that \f[CR]pam_himmelblau.so\f[R] be placed before \f[CR]pam_unix.so\f[R] in the pam \f[CR]auth\f[R] stack (but always after \f[CR]pam_localuser.so\f[R]), otherwise \f[CR]pam_unix\f[R] will unnecessarily prompt for a password.
.IP
.EX
auth        required      pam_env.so
auth        [default=1 ignore=ignore success=ok] pam_localuser.so
auth        sufficient    pam_unix.so nullok try_first_pass
auth        sufficient    pam_himmelblau.so ignore_unknown_user
auth        required      pam_deny.so
.EE
.PP
Configure \f[CR]/etc/pam.d/common\-account\f[R] in a similar manner.
.IP
.EX
account    [default=1 ignore=ignore success=ok] pam_localuser.so
account    sufficient    pam_unix.so
account    sufficient    pam_himmelblau.so ignore_unknown_user
account    required      pam_deny.so
.EE
.PP
In \f[CR]/etc/pam.d/common\-session\f[R], set
\f[CR]pam_himmelblau.so\f[R] as an optional module.
.IP
.EX
session optional    pam_systemd.so
session required    pam_limits.so
session optional    pam_unix.so try_first_pass
session optional    pam_umask.so
session optional    pam_himmelblau.so
session optional    pam_env.so
.EE
.PP
In \f[CR]/etc/pam.d/common\-password\f[R], set
\f[CR]pam_himmelblau.so\f[R] as sufficient.
.IP
.EX
password    sufficient  pam_himmelblau.so ignore_unknown_user
password        optional        pam_gnome_keyring.so    use_authtok
password    sufficient  pam_unix.so use_authtok nullok shadow try_first_pass 
password    required    pam_deny.so
.EE
.SH RETURN VALUES
.IP \(bu 2
\f[B]PAM_SUCCESS\f[R]
.PD 0
.P
.PD
Authentication or Hello PIN update succeeded.
.IP \(bu 2
\f[B]PAM_AUTH_ERR\f[R]
.PD 0
.P
.PD
Authentication failed.
This may include incorrect credentials, rejected MFA, or other
auth\-layer failures.
.IP \(bu 2
\f[B]PAM_USER_UNKNOWN\f[R]
.PD 0
.P
.PD
The user was not found in Entra ID.
This is bypassed if the \f[CR]ignore_unknown_user\f[R] option is
specified.
.IP \(bu 2
\f[B]PAM_IGNORE\f[R]
.PD 0
.P
.PD
The module was instructed to skip processing (e.g., due to
\f[CR]ignore_unknown_user\f[R]).
This allows fallback to other PAM modules.
.IP \(bu 2
\f[B]PAM_SERVICE_ERR\f[R]
.PD 0
.P
.PD
A configuration or initialization error occurred in the module, or a
required daemon was unreachable.
.IP \(bu 2
\f[B]PAM_CRED_INSUFFICIENT\f[R]
.PD 0
.P
.PD
The user did not meet the required credential policy.
.IP \(bu 2
\f[B]PAM_ABORT\f[R]
.PD 0
.P
.PD
A critical, unrecoverable failure occurred\(emsuch as a panic inside the
\f[CR]himmelblaud\f[R] service.
.SH SEE ALSO
\f[B]himmelblaud(8)\f[R], \f[B]aad\-tool(1)\f[R],
\f[B]himmelblau.conf(5)\f[R], \f[B]pam(8)\f[R]
.SH AUTHOR
David Mulder \c
.MT dmulder@himmelblau-idm.org
.ME \c
, \c
.MT dmulder@samba.org
.ME \c
